<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LoanShield - Dashboard</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}?v=19"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
      /* UNIQUE DASHBOARD THEME - CLEAN WHITE ENTERPRISE CONSOLE */
      body {
        background-color: #f8fafc;
      }

      .dashboard-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
      }

      .dash-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 30px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        padding-bottom: 20px;
      }

      .dash-title {
        font-size: 36px;
        color: #0f172a;
        font-weight: 800;
        letter-spacing: -0.5px;
      }

      .dash-subtitle {
        color: #475569;
        font-size: 15px;
        font-family: "Inter";
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
        margin-bottom: 35px;
      }

      .stat-card {
        background: #ffffff;
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-radius: 16px;
        padding: 25px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.06);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 4px;
      }

      .stat-card.safe::before {
        background: #10b981;
      }

      .stat-card.danger::before {
        background: #ef4444;
      }

      .stat-card.total::before {
        background: #3b82f6;
      }

      .stat-img {
        width: 34px;
        height: 34px;
        object-fit: contain;
      }

      .stat-card:hover .stat-img {
        transform: scale(1.1);
        transition: 0.3s ease;
      }

      .stat-icon {
        margin-bottom: 12px;
      }

      .stat-value {
        font-size: 42px;
        font-family: "Outfit";
        font-weight: 800;
        color: #0f172a;
      }

      .stat-label {
        color: #64748b;
        font-size: 14px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .charts-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px;
        margin-bottom: 35px;
      }

      .chart-box {
        background: #ffffff;
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      }

      .chart-title {
        font-family: "Outfit";
        font-size: 18px;
        color: #0f172a;
        margin-bottom: 20px;
        font-weight: 700;
      }

      .table-box {
        background: #ffffff;
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-radius: 16px;
        padding: 25px;
        overflow-x: auto;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      }

      table {
        width: 100%;
        min-width: 900px;
        border-collapse: collapse;
      }

      th {
        background: #f1f5f9;
        color: #475569;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 1px;
        padding: 15px;
        text-align: left;
        border-bottom: 2px solid #e2e8f0;
      }

      td {
        padding: 15px;
        border-bottom: 1px solid #e2e8f0;
        color: #334155;
        font-size: 14px;
        font-family: "Inter";
      }

      tr:hover td {
        background: #f8fafc;
      }

      .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .badge.safe {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border: 1px solid rgba(16, 185, 129, 0.3);
      }

      .badge.danger {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      @media (max-width: 950px) {
        .stats-grid,
        .charts-grid {
          grid-template-columns: 1fr;
        }

        .dash-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
      }
    </style>
  </head>

  <body>
    {% include 'navbar.html' %}

    <div class="page-wrapper" style="padding: 120px 20px 50px">
      <div class="dashboard-wrapper fade-in">
        <div class="dash-header">
          <div>
            <h1 class="dash-title">Analytics Dashboard</h1>
            <div class="dash-subtitle">
              Real-time overview of risk predictions and operations.
            </div>
          </div>
          <a
            href="/predict"
            style="
              background: #3b82f6;
              color: white;
              padding: 10px 20px;
              border-radius: 8px;
              font-weight: 600;
              font-family: &quot;Outfit&quot;;
            "
            >New Analysis</a
          >
        </div>

        <div class="stats-grid">
          <div class="stat-card predict">
            <img
              src="{{ url_for('static', filename='img/forecast.png') }}"
              alt="Total Predictions"
              class="stat-img"
            />
            <div class="stat-value">{{ total }}</div>
            <div class="stat-label">Total Predictions</div>
          </div>
          <div class="stat-card safe">
            <img
              src="{{ url_for('static', filename='img/shield.png') }}"
              alt="Total Predictions"
              class="stat-img"
            />
            <div class="stat-value">{{ safe }}</div>
            <div class="stat-label">Approved (Safe)</div>
          </div>
          <div class="stat-card danger">
            <img
              src="{{ url_for('static', filename='img/danger-sign.png') }}"
              alt="Total Predictions"
              class="stat-img"
            />
            <div class="stat-value">{{ danger }}</div>
            <div class="stat-label">High Risk</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-box">
            <div class="chart-title">Risk Distribution</div>
            <canvas id="pieChart" style="max-height: 280px"></canvas>
          </div>
          <div class="chart-box">
            <div class="chart-title">Approval Metrics</div>
            <canvas id="barChart" style="max-height: 280px"></canvas>
          </div>
        </div>

        <div class="table-box">
          <div class="chart-title" style="margin-bottom: 25px">
            Recent Predictions Log
          </div>
          <table>
            <thead>
              <tr>
                <th>Age</th>
                <th>Income</th>
                <th>Loan Amt</th>
                <th>Credit</th>
                <th>DTI</th>
                <th>Education</th>
                <th>Employment</th>
                <th>Risk Assessment</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for row in history %}
              <tr>
                <td>{{ row.age }}</td>
                <td>₹{{ "{:,.0f}".format(row.income) }}</td>
                <td>₹{{ "{:,.0f}".format(row.loan_amount) }}</td>
                <td>{{ row.credit_score }}</td>
                <td>{{ row.dti_ratio }}</td>
                <td>{{ row.education }}</td>
                <td>{{ row.employment }}</td>
                <td>
                  {% if row.prediction == 0 %}
                  <span class="badge safe">Low Risk</span>
                  {% else %}
                  <span class="badge danger">High Risk</span>
                  {% endif %}
                </td>
                <td>
                  <form
                    action="/delete_prediction/{{ row.id }}"
                    method="POST"
                    style="margin: 0"
                  >
                    <button
                      type="submit"
                      class="badge danger"
                      style="
                        cursor: pointer;
                        background: rgba(239, 68, 68, 0.1);
                        border: 1px solid rgba(239, 68, 68, 0.3);
                        padding: 6px 14px;
                      "
                      onclick="return confirm('Remove this prediction log?');"
                    >
                      Remove
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %} {% if not history %}
              <tr>
                <td
                  colspan="9"
                  style="text-align: center; padding: 40px; color: #64748b"
                >
                  No prediction history available.
                </td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Chart Configuration (Light Mode Optimized) -->
    <script>
      Chart.defaults.color = '#475569';
      Chart.defaults.font.family = 'Inter';

      const safe = {{ safe }};
      const danger = {{ danger }};

      new Chart(document.getElementById('pieChart'), {
          type: 'doughnut',
          data: {
              labels: ['Safe', 'High Risk'],
              datasets: [{
                  data: [safe, danger],
                  backgroundColor: ['#10b981', '#ef4444'],
                  borderWidth: 2,
                  borderColor: '#ffffff',
                  hoverOffset: 4
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: '70%',
              plugins: {
                  legend: { position: 'bottom', labels: { padding: 20, font: { size: 13, weight: 500 } } }
              }
          }
      });

      new Chart(document.getElementById('barChart'), {
          type: 'bar',
          data: {
              labels: ['Low Risk (Safe)', 'High Risk'],
              datasets: [{
                  data: [safe, danger],
                  backgroundColor: ['#34d399', '#f87171'],
                  borderRadius: 6,
                  barPercentage: 0.6
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: {
                  y: { grid: { color: 'rgba(0,0,0,0.05)' }, border: { display: false } },
                  x: { grid: { display: false }, border: { display: false } }
              }
          }
      });
    </script>
  </body>
</html>
